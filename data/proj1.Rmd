---
title: "So what happens after they move to USA?"
author: "Chi Zhi, Huilong An,Yiwei Sun, Youzhu Liu"
date: "2016??9??18??"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Summary

Using the 2014 American Community Surveys, this report provides a detailed picture of the more than xxxxx million immigrants (legal and illegal) and their U.S.-born children (under 18) in the United States by place of birth, state. One of the most important findings is that immigration has dramatically increased the size of the nation??s low-income population; however, there is great variation among immigrants by sending country and region. Moreover, many immigrants make significant progress the longer they live in the country. But even with this progress, immigrants who have been in the United States for 20 years are much more likely to live in poverty, lack health insurance, and access the welfare system than are native-born Americans. The large share of immigrants arriving as adults with relatively little education partly explains this phenomenon.

For more details on github see <http://ะก??github??าณ>.

## 1. Who move to US
When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

### 1.1 Where are immigrants from?
### 1.2 Sex, Age, Marriage

## 2. Education Status
The education attainment plot of 10 countries/areas with largest immigrant groups.
```{r echo=FALSE,message=FALSE,warning=FALSE}
## ads project 1 
library(data.table)
library(dplyr)
library(ggplot2)
library(plotly)
#read the project main data
data1=fread("G:/Columbia/study/3rd semester/5243/select_parta.csv")
data2=fread("G:/Columbia/study/3rd semester/5243/select_partb.csv")
#data=rbind(data1,data2)
data=data1
data[,c("V1"):=NULL]
# read the adjusted place of birth data
pof=read.table("G:/Columbia/study/3rd semester/5243/placeofbirth.txt",sep=" ")[,1:3]
names(pof)=c("code","state","state_abb")
pof=tbl_df(pof)

schl=read.table("G:/Columbia/study/3rd semester/5243/result_school.txt",sep="")
names(schl)=c("code","Education level")

states=pof[1:56,]
others=pof[57:215,]

#merge POBP in data with pof$code, give name
data$POBP_name=pof[match(data$POBP,pof$code),2]
#merge SCHL with 
data$SCHL_name=schl[match(data$SCHL,schl$code),2]

#completed cases for test
com_data=data[complete.cases(data),]

#divide data into immigrants/non-immigrants
noni=filter(data,POBP %in% states$code)
imm=filter(data,POBP %in% others$code)
#find the largest immigration groups
top10=names(sort(table(imm$POBP),decreasing=T))[1:10]#rank the imm numbers, find top 10
imm_top10=filter(imm,POBP %in% top10)
com_imm_top10=filter(imm_top10,!is.na(SCHL_name)) #top 10 immigrants with completed SCHL info
#descriptive data
#ggplot(data, alpha = 0.2,aes(x = WAGP, fill = POBP))+geom_histogram(position="dodge")
com_imm_top10=arrange(com_imm_top10,SCHL)
com_imm_top10$SCHL_name=factor(com_imm_top10$SCHL_name, 
                      levels = com_imm_top10$SCHL_name[order(com_imm_top10$SCHL)]) #change SCHL into factor
p=ggplot(com_imm_top10,aes(POBP_name,SCHL_name,col=POBP_name,size=..n..))+ 
      geom_count()+
      labs(col="count",size="count")+
      xlab("Place of Birth")+ylab("Education Attainment(Grade)")+
      theme(
        plot.title = element_text(color="red", size=14, face="bold.italic"),
        axis.title.x = element_text(color="blue", size=14, face="bold"),
        axis.title.y = element_text(color="#993333", size=14, face="bold")
      )+coord_fixed(ratio = 0.01)
ggplotly(p)

```
Findings:

## 3. Working Status


